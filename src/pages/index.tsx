import type { GetServerSideProps } from 'next';
import Head from 'next/head';
import { useEffect, useState } from 'react';
import { getLoggedInUser } from '../apiHandlers/auth';
import Header from '../components/Header';
import Loader from '../components/Loader';
import Sidebar from '../components/Sidebar';

interface Data {
    loggedIn: boolean;
    user: any;
}

export const getServerSideProps: GetServerSideProps = async ({ req }) => {
    const token = req.cookies.relief_work_token || '';

    const data = await getLoggedInUser(token);

    if (!data.loggedIn) {
        return {
            redirect: {
                destination: '/login',
                permanent: false,
            },
        };
    }

    return {
        props: data,
    };
};

const Home = ({ loggedIn }: Data) => {
    const [isLoading, setIsLoading] = useState(true);

    useEffect(() => {
        setIsLoading(false);
        console.log({ loggedIn });
    }, [loggedIn]);

    return (
        <div className="relative">
            <Head>
                <title>Relief Work | Home</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            {/* loader */}
            {isLoading ? <Loader /> : null}

            <Header />

            <main className="bg-gray-50">
                <Sidebar />
            </main>
        </div>
    );
};

export default Home;
