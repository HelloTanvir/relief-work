import axios from 'axios';
import type { NextPage } from 'next';
import Head from 'next/head';
import { useRouter } from 'next/router';
import { useEffect } from 'react';
import Header from '../components/Header';
import Sidebar from '../components/Sidebar';

const Home: NextPage = () => {
    const router = useRouter();

    useEffect(() => {
        const apiResponse = async () => {
            let token = '';

            if (typeof window !== 'undefined') {
                token = localStorage.getItem('relief_work-token') || '';
            }

            if (!token) {
                router.push('/login');
            }

            try {
                await axios.get(`${process.env.NEXT_PUBLIC_API}/auth/me`, {
                    headers: { Authorization: `Bearer ${token}` },
                });
            } catch (err) {
                console.log(err);
                router.push('/login');
            }
        };
        apiResponse();
    }, [router]);

    return (
        <div className="relative">
            <Head>
                <title>Relief Work | Home</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <Header />

            <main className="bg-gray-50">
                <Sidebar />
            </main>
        </div>
    );
};

export default Home;
